# clover_tube_monitoring
INSTRUCTION
Программа для мониторинга нефтепровода в симуляторе Gazebo.
Данный проект выполнялся в виртуальной машине, которая имела всё необходимое для работы с платформой клевер, поэтому для запуска проекта рекомендуется установить образ виртуальной машины по ссылке https://clover.coex.tech/ru/simulation_vm.html и далее выполнять все последующие шаги уже в ней.
После запуска виртуальной машины нужно клонировать репозиторий, в котором находится проект. Для клонирования репозитория нужно скопировать URL-адрес репозитория с вкладки <> Code на его странице, а затем в командной строке (терминале) выполните команду git clone [URL] (на месте [URL] должен стоять скопированный URL-адрес). Если не получается, то воспользуйтесь инструкцией по ссылке https://docs.github.com/ru/repositories/creating-and-managing-repositories/cloning-a-repository#cloning-a-repository . 

Далее следует произвести некотрые замены файлов в Gazebo. Для этого нужно перейти в директорию /home/clover/catkin_ws/src/clover/clover_simulation/resources/ и скопировать туда папку worlds, которая находится в скаченном репозитории (то есть нужно заменить уже существующую папку worlds на новую папку, которую мы скопировали из репозитория). Таким же образом нужно зайти в директорию /home/clover/catkin_ws/src/clover/clover_simulation/models и скопировать туда папку models (заменить существующую папку models на новую). Теперь необходимо настроить симулятор, изменив некоторые параметры(эти действия также описаны здесь https://clover.coex.tech/ru/auto_setup.html). Заходим в директорию /home/clover/catkin_ws/src/clover/clover/launch/ и ищем файлы aruco.launch и clover.launch. Открываем aruco.launch, в этом файле меняем "false" на "true" в строчке <arg name="aruco_map" default="..."/> и в строчке <arg name="aruco_vpe" default="..."/>. Далее открываем clover.launch и меняем "false" на "true" в строчке <arg name="aruco" default="..."/>. Также, в случае, если у вас в clover.launch в строке <arg name="rangefinder_vl53l1x" default="..."/> стоит "false", то нужно поменять "false" на "true". Далее открываем терминал и вставляем команду rosrun aruco_pose genmap.py 0.335 10 10 1 1 0 > ~/catkin_ws/src/clover/aruco_pose/map/map.txt --top-left . 

Подготовка окончена, теперь можно приступать к запуску программы. Для начала сгенерируем мир с трубой и случайными врезками. Для этого заходим в папку репозитория, в которой находится WorldChanger.py и открываем в этой папке терминал. Пишем команду python3  WorldChanger.py . Мир сгенерирован, теперь, если нужно будет задать новое случайное положение врезок, нужно будет повторить запуск программы WorldChanger.py через терминал.

Далее заходим в симулятор Gazebo. После того, как Gazebo открылся, заходим опять в папку репозитория, открываем в ней терминал и пишем команду python3  main_programm.py . Запускаем, после чего дрон в симуляторе должен начать полёт. Чтобы посмотреть координаты врезок, нужно открыть новый терминал, написать roscore и после этого написать rostopic echo /tubes (сделать это лучше всего до того, как дрон взлетит). Выведутся координаты врезок.
